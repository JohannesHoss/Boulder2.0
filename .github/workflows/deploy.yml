name: Deploy to Edge

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: false
        default: 'main'
        type: choice
        options:
          - main
          - pre

jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger edge deployment
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.INFRA_DISPATCH_TOKEN }}
          repository: christophvarga/0000__infra-multi__ci-cd
          event-type: edge-deploy
          client-payload: |
            {
              "app_name": "boulder",
              "environment": "${{ github.event.inputs.environment || 'main' }}",
              "branch": "${{ github.ref_name }}"
            }

      - name: Log dispatch
        run: |
          echo "Triggered edge-deploy for boulder"
          echo "  Environment: ${{ github.event.inputs.environment || 'main' }}"
          echo "  Branch: ${{ github.ref_name }}"
          echo "  Infra repo: christophvarga/0000__infra-multi__ci-cd"
